---
import { Icon } from "astro-icon/components";
---

<button
  id="theme-toggle"
  class="inline-flex items-center border-0 bg-transparent p-0 text-zinc-500 transition-colors hover:text-zinc-900 dark:hover:text-zinc-100"
  aria-label="Toggle theme"
  transition:persist
>
  <span class="sr-only">Toggle theme</span>
  <Icon
    id="sun"
    name="material-symbols:light-mode-outline"
    width="20"
    height="20"
    class="hidden leading-none dark:block"
  />
  <Icon
    id="moon"
    name="material-symbols:dark-mode-outline"
    width="20"
    height="20"
    class="leading-none dark:hidden"
  />
</button>

<script>
  function attachThemeToggle() {
    const button = document.getElementById("theme-toggle");
    if (!button) return;
    if (button instanceof HTMLElement && button.dataset.bound === "1") return;

    button.addEventListener("click", () => {
      const isDark = document.documentElement.classList.toggle("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
    if (button instanceof HTMLElement) button.dataset.bound = "1";
  }

  // 初始化和页面切换时都重新绑定
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", attachThemeToggle, {
      once: true,
    });
  } else {
    attachThemeToggle();
  }
  document.addEventListener("astro:page-load", attachThemeToggle);
</script>
